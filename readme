rm-viewer is a software to sync the contents of your reMarkable and view it
from a web UI.
 - It automatically syncs changes from your reMarkable as you use it.
 - It does handwriting recongition on your handwriting, and creates PDFs with
   overlayed invisible text, allowing you to search and copy your handwriting.
 - It allows you to search all your notes.
 - The viewer works great on a mobile phone.

The following install instructions are tested on python3.12 and python3.14, on
Ubuntu 24 and macOS.

Install rsync.

Install google chrome:
$ curl -LO https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
$ apt install -y ./google-chrome-stable_current_amd64.deb

For handwriting recongition, create a file called 'gcv_api_key' with your
Google Cloud Vision API key in this directory.
Use the scripts in debug/ to test your key and make sure it works.

We have to use the legacy pip resolver to ignore some dependency conflicts that
aren't actually conflicts while installing rm-viewer.
$ python3 -m .venv venv
$ source .venv/bin/activate
$ pip install --use-deprecated=legacy-resolver -r requirements.txt

Set up sync folder (in rm-viewer directory):
$ python3 -m rm_viewer syncd --install sync
Note down the value it says to set SYNC_DIR to.

Copy the device installation template directory
$ cp -r .rm-viewer rm-viewer-install
In the new folder (rm-viewer-install), fill in config.sh. You may want to set:
  - REMOTE_USER and REMOTE_HOST (current user and hostname/ip)
  - SYNC_DIR (full path of sync folder)
  - RSYNC_REMOTE (path to rsync binary)
  - DEBOUNCE is shortest interval between the device doing syncs, change if
    needed.

Now, let's do an initial manual sync.

Do an initial copy of your xochitl  directory (this is where your reMarkable
files are stores) to the sync directory. Probably best to do this over the usb
connection.

ssh into your reMarkable and run:
$ rsync -av \
    --partial-dir .rsync-partial \
    --no-compress \
    --delete-delay \
    --info=progress2,stats1 \
    --rsync-path=/opt/homebrew/bin/rsync \
    --exclude='*.thumbnails/***' \
    -e 'ssh -i /home/root/key' \
    /home/root/.local/share/remarkable/xochitl/ \
    user@remote:/home/bigdog/remarkable/rm-viewer/sync/xochitl-dirty/
If you want to create an ssh key, run:
$ dropbearkey -f /home/root/key
Delete the key afterwards as we will set up another one as part of the
installation on the device.

Then on the remote, run this (indicates to rm-viewer that we have files needing
to be processed):
$ touch sync/syncflag

Now, let's run an initial process of the files, and test the webUI.

This command processes the xochitl directory and buidls a search index,
generates thumbnails and does OCR, and stores the results in
sync/stable/process_out. Chrome emits a lot of warnings/errors, but they can be
ignored.

$ python3 -m rm_viewer processor sync/xochitl-dirty sync/stable/process_out

This may take a while (20 minutes for me), on the first process. Every
subsequent processing run is incremental, and only processes the changes.


then scp onto device to /home/root/.rm-viewer
then run the following to make root and /etc writeable:
    umount -R /etc # unmount etc overlay
    mount -o remount,rw /  # mount system as writeable
then, in /home/root/.rm-viewer, run:
    ./install.sh

copy generated ssh key to remote.

then remount root as read only:
    mount -o remount,ro /
